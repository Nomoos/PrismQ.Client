# TaskManager Worker Supervisor Configuration
#
# Installation:
# 1. Copy this file to /etc/supervisor/conf.d/taskmanager-worker.conf
# 2. Update the paths and API URL for your environment
# 3. Run: sudo supervisorctl reread
# 4. Run: sudo supervisorctl update
# 5. Run: sudo supervisorctl start taskmanager-worker:*
#
# Management:
#   sudo supervisorctl status taskmanager-worker:*
#   sudo supervisorctl restart taskmanager-worker:*
#   sudo supervisorctl stop taskmanager-worker:*
#   sudo supervisorctl tail -f taskmanager-worker:worker-00 stdout

[program:taskmanager-worker]
# IMPORTANT: Update the path and API URL for your environment
command=/usr/bin/php /path/to/examples/workers/php/worker.php 
    --api-url=https://api.example.com/api
    --worker-id=worker-%(process_num)02d
    --poll-interval=5

# Working directory
directory=/path/to/examples/workers/php

# Run multiple worker processes (scale as needed)
process_name=%(program_name)s-%(process_num)02d
numprocs=3

# Auto-start and auto-restart
autostart=true
autorestart=true
startretries=3

# User and group
user=www-data
# group=www-data  # Optional, defaults to user's primary group

# Graceful shutdown
stopsignal=TERM
stopwaitsecs=30
stopasgroup=true
killasgroup=true

# Logging
redirect_stderr=true
stdout_logfile=/var/log/taskmanager/worker-%(process_num)02d.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5

# Standard output logging
# stdout_events_enabled=true  # Enable if using event listeners

# Priority (lower = starts earlier)
priority=999

# Environment variables (optional)
environment=DEBUG="false",MAX_RUNS="0"
